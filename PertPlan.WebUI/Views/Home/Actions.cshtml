@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

<svg id="pert-diagram" width="100%" height="600">

</svg>

<script type="module">
    import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

    const tasks = [
        { id: "A" },
        { id: "B" },
        { id: "C" },
        { id: "D" },
    ];

    const dependencies = [
        { source: "A", target: "B" },
        { source: "A", target: "C" },
        { source: "B", target: "D" },
        { source: "C", target: "D" },
    ];

    const svg = d3.select("#pert-diagram");

    const simulation = d3.forceSimulation()
        .nodes(tasks)
        .force("link", d3.forceLink(dependencies).id((d) => d.id).distance(300))
        .force("charge", d3.forceManyBody().strength(-200))
        .force("center", d3.forceCenter(400, 200));

    const links = svg
        .selectAll("line")
        .data(dependencies)
        .enter()
        .append("line")
        .attr("stroke", "gray");

    const nodes = svg
        .selectAll("circle")
        .data(tasks)
        .enter()
        .append("circle")
        .attr("r", 20)
        .attr("fill", "lightblue");

    const labels = svg
        .selectAll("text")
        .data(tasks)
        .enter()
        .append("text")
        .text((d) => d.id)
        .attr("text-anchor", "middle")
        .attr("dy", "0.3em");

    simulation.on("tick", () => {
        nodes
            .attr("cx", (d) => d.x)
            .attr("cy", (d) => d.y);

        labels
            .attr("x", (d) => d.x)
            .attr("y", (d) => d.y);

        links
            .attr("x1", (d) => d.source.x)
            .attr("y1", (d) => d.source.y)
            .attr("x2", (d) => d.target.x)
            .attr("y2", (d) => d.target.y);
    });
</script>